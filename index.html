<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dog Services Dashboard</title>
<style>
  body {font-family: Arial, sans-serif; background: #eef2f7; margin:0; padding:0;}
  .container {max-width: 1600px; margin: 20px auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.08);}
  h1 {margin-bottom: 20px; font-size: 28px; color: #333;}
  .date-controls {display: flex; align-items: center; gap: 10px; margin-bottom: 20px;}
  .date-btn, .date-nav, #ratesBtn {padding: 10px 18px; font-size: 16px; cursor: pointer; border-radius:6px; border:1px solid #ccc; background:#fff; transition:0.2s;}
  .date-btn:hover, .date-nav:hover, #ratesBtn:hover {background:#f0f4f8;}
  .daily-total {margin-left:20px; font-weight:bold; font-size:18px; color:green;}
  .dropdowns {display:flex; gap:20px; margin-bottom:20px;}
  .dropdown {position: relative; display: inline-block;}
  .dropdown button {width: 160px; text-align:left; border:1px solid #ccc; border-radius:6px; background:#fff; padding:10px;}
  .dropdown-content {display: none; position: absolute; background-color: #f9f9f9; min-width: 180px; box-shadow: 0px 4px 12px rgba(0,0,0,0.15); z-index: 1; border-radius: 8px; max-height: 300px; overflow-y: auto; margin-top:5px;}
  .dropdown-content button {display: block; width: 100%; border: none; background: none; padding: 8px 12px; text-align: left; cursor: pointer; border-radius: 5px; transition:0.2s;}
  .dropdown-content button:hover {background:#2b6cb0; color:#fff;}
  .dropdown-content button.selected {background:#2b6cb0; color:#fff;}
  table {width:100%; border-collapse: collapse; margin-top:20px; font-size:14px;}
  th, td {padding:10px; border:1px solid #ddd; text-align:right;}
  th {background:#f1f5f9; text-align:left; font-weight:600;}
  td.currency {white-space: nowrap;}
  td.weekday {text-align:center; font-weight:500; color:#555;}
  tr.weekend {background-color:#fff3e0;}
  /* Rates Modal */
  #ratesModal {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;}
  #ratesModalContent {background:#fff; padding:20px; border-radius:10px; max-width:700px; max-height:80%; overflow-y:auto;}
  #ratesModalContent table {width:100%; border-collapse: collapse; margin-top:10px;}
  #ratesModalContent th, #ratesModalContent td {border:1px solid #ccc; padding:8px; text-align:center;}
  #ratesModalContent input {width:60px;}
  #ratesModalContent button {margin-top:10px; margin-right:5px; padding:8px 12px; cursor:pointer;}
  .edit-btn {background:#f0ad4e; color:#fff; border:none; border-radius:5px; cursor:pointer; padding:5px 10px;}
  .edit-btn:hover {background:#ec971f;}
</style>
</head>
<body>
<div class="container">
  <h1>Dog Services Dashboard</h1>

  <div class="date-controls">
    <button id="prevDay" class="date-nav">&lt;</button>
    <button id="dateBtn" class="date-btn"></button>
    <button id="nextDay" class="date-nav">&gt;</button>
    <span class="daily-total" id="dailyTotal">Total: 0 €</span>
    <button id="ratesBtn">Rates</button>
  </div>

  <div class="dropdowns" id="serviceDropdowns"></div>

  <table id="paymentTable">
    <thead>
      <tr>
        <th>Día</th>
        <th>Fecha</th>
        <th>Total (€)</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<!-- Rates Modal -->
<div id="ratesModal">
  <div id="ratesModalContent">
    <h2>Dog Rates (€)</h2>
    <table id="ratesTable">
      <thead>
        <tr>
          <th>Dog</th>
          <th>Daycare</th>
          <th>Weekend</th>
          <th>Overnight</th>
          <th>Walk</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="addDogRateBtn">Add Dog</button>
    <button id="saveRates">Save</button>
    <button id="closeRates">Close</button>
  </div>
</div>

<script>
const spanishDays = ['Dom.','Lun.','Mar.','Mié.','Jue.','Vie.','Sáb.'];

let dogNames = ["PABLO","LILI","JUGNIA","LEO","INDIA","KIMCHI","NINA","CARMELA","CUATRI","TB","NEO","BRISO","ZOZI","R&H"];
let allDogs = [...dogNames];
let rows = [];
let selections = {};
let rates = {};
allDogs.forEach(d => rates[d]={daycare:10, weekend:12, overnight:20, walk:5});

let currentDate = new Date();
const dateBtn=document.getElementById('dateBtn');
const tbody=document.getElementById('tableBody');
const serviceDropdowns=document.getElementById('serviceDropdowns');
const dailyTotalSpan = document.getElementById('dailyTotal');

function formatDate(d){ const dd=String(d.getDate()).padStart(2,'0'); const mm=String(d.getMonth()+1).padStart(2,'0'); const yyyy=d.getFullYear(); return `${dd}/${mm}/${yyyy}`; }
function getWeekday(d){ return spanishDays[d.getDay()]; }
function updateDateBtn(){ dateBtn.textContent=formatDate(currentDate); updateDailyTotal(); }

function updateDailyTotal(){
  const dateStr=formatDate(currentDate);
  const row = rows.find(r=>r.Fecha===dateStr);
  dailyTotalSpan.textContent = 'Total: '+(row?row.Total.toFixed(2):'0')+' €';
}

// Create service dropdowns
function createServiceDropdowns(){
  serviceDropdowns.innerHTML='';
  ['Daycare','Walk','Overnight'].forEach(service=>{
    const div=document.createElement('div'); div.classList.add('dropdown');
    const btn=document.createElement('button'); btn.textContent=service;
    div.appendChild(btn);

    const content=document.createElement('div'); content.classList.add('dropdown-content');
    allDogs.forEach(dog=>{
      const dogBtn=document.createElement('button'); dogBtn.textContent=dog;
      dogBtn.addEventListener('click', e=>{
        e.stopPropagation();
        toggleDogSelection(dog,service,dogBtn);
      });
      content.appendChild(dogBtn);
    });
    div.appendChild(content);
    serviceDropdowns.appendChild(div);

    btn.addEventListener('click', e=>{
      e.stopPropagation();
      const isVisible = content.style.display==='block';
      closeAllDropdowns();
      content.style.display = isVisible ? 'none':'block';
    });
  });
}

function closeAllDropdowns(){
  document.querySelectorAll('.dropdown-content').forEach(dc=> dc.style.display='none');
}
document.addEventListener('click', closeAllDropdowns);

function toggleDogSelection(dog,service,btn){
  const dateStr=formatDate(currentDate);
  if(!selections[dateStr]) selections[dateStr]={};
  const key=`${dog}_${service}`;
  const selected=!selections[dateStr][key];
  selections[dateStr][key]=selected;
  btn.classList.toggle('selected',selected);
  updateDogPayment(dog,service,selected);
}

function updateDogPayment(dog,service,add=true){
  const dateStr=formatDate(currentDate);
  let row = rows.find(r=>r.Fecha===dateStr);
  if(!row){ 
    row={Fecha:dateStr,Día:getWeekday(currentDate),Total:0,services:{}};
    rows.push(row);
  }
  if(!row.services[dog]) row.services[dog]=0;
  let rate = rates[dog][service.toLowerCase()];
  if(service==='Daycare' && (currentDate.getDay()===0 || currentDate.getDay()===6)) rate=rates[dog].weekend;
  row.services[dog] = add ? row.services[dog]+rate : Math.max(0,row.services[dog]-rate);
  row.Total=Object.values(row.services).reduce((a,b)=>a+b,0);
  updateDailyTotal();
  buildTable();
}

function buildTable(){
  tbody.innerHTML='';
  const tableHead=document.querySelector('#paymentTable thead tr');
  tableHead.innerHTML=`<th>Día</th><th>Fecha</th><th>Total (€)</th>`;
  allDogs.forEach(d=>{ const th=document.createElement('th'); th.textContent=d; tableHead.appendChild(th); });
  tableHead.appendChild(document.createElement('th')).textContent='Editar';

  rows.sort((a,b)=>new Date(a.Fecha.split('/').reverse().join('-'))-new Date(b.Fecha.split('/').reverse().join('-')));
  rows.forEach(r=>{
    const tr=document.createElement('tr');
    const dateParts=r.Fecha.split('/'); 
    const rowDate=new Date(dateParts[2],dateParts[1]-1,dateParts[0]);
    if(rowDate.getDay()===0 || rowDate.getDay()===6) tr.classList.add('weekend');
    tr.innerHTML=`<td class="weekday">${r.Día}</td><td>${r.Fecha}</td><td>${r.Total.toFixed(2)}</td>`;
    allDogs.forEach(d=>{ 
      const td=document.createElement('td'); 
      td.textContent=(r.services[d]||''); 
      td.classList.add('currency'); 
      tr.appendChild(td); 
    });
    // Edit button
    const tdEdit = document.createElement('td');
    const editBtn = document.createElement('button');
    editBtn.classList.add('edit-btn');
    editBtn.textContent='Editar';
    editBtn.onclick = ()=>editRow(r);
    tdEdit.appendChild(editBtn);
    tr.appendChild(tdEdit);
    tbody.appendChild(tr);
  });
}

// Edit row function
function editRow(row){
  currentDate = new Date(row.Fecha.split('/').reverse().join('-'));
  updateDateBtn();
  restoreSelections();
}

updateDateBtn();
createServiceDropdowns();
buildTable();

// Restore selections
function restoreSelections(){
  const dateStr=formatDate(currentDate);
  document.querySelectorAll('.dropdown-content button').forEach(btn=>{
    const dog = btn.textContent;
    const service = btn.closest('.dropdown').querySelector('button').textContent;
    const key = `${dog}_${service}`;
    btn.classList.toggle('selected', selections[dateStr] && selections[dateStr][key]);
  });
}

// Date controls
document.getElementById('prevDay').addEventListener('click',()=>{
  currentDate.setDate(currentDate.getDate()-1); updateDateBtn(); restoreSelections();
});
document.getElementById('nextDay').addEventListener('click',()=>{
  currentDate.setDate(currentDate.getDate()+1); updateDateBtn(); restoreSelections();
});

// Rates modal (unchanged from before)
const ratesModal=document.getElementById('ratesModal');
const ratesTableBody=document.querySelector('#ratesTable tbody');

function populateRatesModal(){
  ratesTableBody.innerHTML='';
  allDogs.forEach(d=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${d}</td>
      <td><input type='number' value='${rates[d].daycare}' id='daycare_${d}'></td>
      <td><input type='number' value='${rates[d].weekend}' id='weekend_${d}'></td>
      <td><input type='number' value='${rates[d].overnight}' id='overnight_${d}'></td>
      <td><input type='number' value='${rates[d].walk}' id='walk_${d}'></td>
      <td><button onclick="deleteDog('${d}')">Delete</button></td>`;
    ratesTableBody.appendChild(tr);
  });
}

function deleteDog(d){
  if(confirm(`Delete ${d}?`)){
    allDogs = allDogs.filter(x=>x!==d);
    delete rates[d];
    createServiceDropdowns();
    populateRatesModal();
    buildTable();
  }
}

document.getElementById('ratesBtn').addEventListener('click',()=>{ populateRatesModal(); ratesModal.style.display='flex'; });
document.getElementById('closeRates').addEventListener('click',()=>{ ratesModal.style.display='none'; });
document.getElementById('saveRates').addEventListener('click',()=>{
  allDogs.forEach(d=>{
    rates[d].daycare=parseFloat(document.getElementById('daycare_'+d).value)||0;
    rates[d].weekend=parseFloat(document.getElementById('weekend_'+d).value)||0;
    rates[d].overnight=parseFloat(document.getElementById('overnight_'+d).value)||0;
    rates[d].walk=parseFloat(document.getElementById('walk_'+d).value)||0;
  });
  ratesModal.style.display='none';
});

document.getElementById('addDogRateBtn').addEventListener('click',()=>{
  const name = prompt("Enter new dog name:");
  if(name && !allDogs.includes(name)){
    allDogs.push(name);
    rates[name]={daycare:10, weekend:12, overnight:20, walk:5};
    createServiceDropdowns();
    populateRatesModal();
    buildTable();
  }
});
</script>
</body>
</html>
