<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Servicios</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#c1802a" />
  <link rel="icon" href="icons/dog-192.png" sizes="192x192" type="image/png" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto; background:#373e2e; padding:20px; min-height:100vh; }
    .container{max-width:1200px;margin:0 auto;background:#e3ddb4;padding:40px;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);}    
    h1{text-align:center;margin-bottom:20px;color:#373e2e;}

    .date-controls{display:flex;justify-content:center;gap:10px;margin-bottom:25px;}
    .date-btn,.date-nav{padding:12px 20px;border:none;border-radius:10px;font-weight:600;cursor:pointer;}
    .date-btn{background:#c1802a;color:white;}
    .date-nav{background:white;color:#c1802a;border:2px solid #c1802a;}

    .services{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:20px;margin:20px 0;}
    .service-btn{padding:25px;background:#d4cba8;border-radius:16px;border:2px solid #8a8252;cursor:pointer;text-align:center;transition:0.3s;}
    .service-btn:hover{background:#c1802a;color:white;transform:translateY(-4px);}    

    .summary{background:#d4cba8;padding:20px;border-radius:16px;border:2px solid #8a8252;margin-top:30px;}
    #summaryContent{line-height:1.6;}

    .totals{display:flex;justify-content:center;gap:15px;margin-top:25px;}
    .totals span{background:#d4cba8;padding:12px 20px;border-radius:10px;border:2px solid #8a8252;}

    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;}
    .modal-content{background:white;padding:25px;border-radius:16px;max-width:500px;width:90%;max-height:80vh;overflow:auto;}
    .dog-list{display:flex;flex-direction:column;gap:10px;}

    .dog-box{display:flex;flex-direction:column;gap:6px;padding:10px;border:2px solid #8a8252;border-radius:10px;background:white;}
    .dog-box.selected{border-color:#c1802a;background:#f7e4c2;}

    .modal-buttons{display:flex;justify-content:flex-end;gap:10px;margin-top:15px;}

  </style>
</head>
<body>
  <div class="container">
    <h1>üêï Hola Lucas</h1>

    <div class="date-controls">
      <button id="prevDay" class="date-nav">&lt;</button>
      <button id="dateBtn" class="date-btn"></button>
      <button id="nextDay" class="date-nav">&gt;</button>
    </div>

    <div class="services">
      <div class="service-btn" data-service="Daycare">Guarder√≠a</div>
      <div class="service-btn" data-service="Walk">Paseo</div>
      <div class="service-btn" data-service="Overnight">Noche</div>
      <div class="service-btn" data-service="Extra">Extra</div>
    </div>

    <div style="text-align:center;"><button id="ratesBtn">Tarifas</button> <button id="viewTableBtn">Ver Tabla</button></div>

    <div class="summary"><h3>üìã Resumen:</h3><div id="summaryContent">No hay servicios seleccionados.</div></div>
    <div class="totals"><span id="dailyTotal">Hoy: 0 ‚Ç¨</span><span id="weeklyTotal">Semana: 0 ‚Ç¨</span><span id="monthlyTotal">Mes: 0 ‚Ç¨</span></div>
  </div>

  <!-- Dog Modal -->
  <div id="dogModal" class="modal">
    <div class="modal-content">
      <h2 id="serviceTitle">Servicio</h2>
      <div id="dogList" class="dog-list"></div>
      <div class="modal-buttons"><button id="saveDogSelection">Guardar</button><button id="closeDogModal">Cerrar</button></div>
    </div>
  </div>

  <!-- Time Modal -->
  <div id="timeModal" class="modal">
    <div class="modal-content" style="max-width:320px;">
      <h2>Horario</h2>
      <label>Inicio:</label>
      <input id="startTimeInput" type="time" />
      <label>Fin:</label>
      <input id="endTimeInput" type="time" />
      <div class="modal-buttons"><button id="saveTimeBtn">Guardar</button><button id="closeTimeModal">Cancelar</button></div>
    </div>
  </div>

<script>
/* === DATA === */
const defaultDogs = ["PABLO","LILI","JUGNIA","LEO","INDIA","KIMCHI","NINA","CARMELA","CUATRI","TB","NEO","BRISO","ZOZI","R&H"];
let allDogs = JSON.parse(localStorage.getItem('allDogs')) || defaultDogs;
let selections = JSON.parse(localStorage.getItem('selections')) || {};

/* === DATE === */
let currentDate = new Date();
const formatDate = d => `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;
function updateDate(){ document.getElementById('dateBtn').textContent = formatDate(currentDate); }
updateDate();

prevDay.onclick = ()=>{ currentDate.setDate(currentDate.getDate()-1); updateDate(); updateSummary(); };
nextDay.onclick = ()=>{ currentDate.setDate(currentDate.getDate()+1); updateDate(); updateSummary(); };

dateBtn.onclick = ()=>{
  const input=document.createElement('input'); input.type='date'; input.style.display='none'; document.body.appendChild(input);
  input.valueAsDate=currentDate; input.click();
  input.onchange=()=>{ currentDate=new Date(input.value); updateDate(); updateSummary(); input.remove(); };
};

/* === SERVICE MODAL === */
let currentService = "";
const dogModal = document.getElementById('dogModal');
const dogList = document.getElementById('dogList');

function openDogModal(service) {
  currentService = service;
  dogList.innerHTML = "";
  const dateKey = formatDate(currentDate);

  allDogs.forEach(dog => {
    const key = `${dog}_${service}`;

    const box = document.createElement("div");
    box.className = "dog-box";

    const title = document.createElement("div");
    title.textContent = dog;
    title.style.fontWeight = "600";

    const start = document.createElement("input"); start.type = "time";
    const end = document.createElement("input"); end.type = "time";

    if (selections[dateKey]?.[key]) {
      box.classList.add("selected");
      start.value = selections[dateKey][key].start || "";
      end.value = selections[dateKey][key].end || "";
    }

    start.onchange = end.onchange = ()=>{
      if (!selections[dateKey]) selections[dateKey] = {};
      selections[dateKey][key] = { selected:true, start:start.value, end:end.value };
      box.classList.add("selected");
      updateSummary();
    };

    title.onclick = ()=>{
      if (box.classList.contains("selected")) {
        box.classList.remove("selected");
        delete selections[dateKey][key];
      } else {
        box.classList.add("selected");
        selections[dateKey][key] = { selected:true, start:"", end:"" };
      }
      updateSummary();
    };

    box.appendChild(title);
    box.appendChild(start);
    box.appendChild(end);
    dogList.appendChild(box);
  });

  dogModal.style.display = "flex";
}

closeDogModal.onclick = ()=> dogModal.style.display="none";
saveDogSelection.onclick = ()=>{ dogModal.style.display="none"; localStorage.setItem('selections',JSON.stringify(selections)); updateSummary(); };

/* === SERVICE CLICK === */
document.querySelectorAll('.service-btn').forEach(btn => {
  btn.onclick = ()=> openDogModal(btn.dataset.service);
});

/* === SUMMARY === */
function updateSummary() {
  const dateKey = formatDate(currentDate);
  const div = document.getElementById('summaryContent');

  if (!selections[dateKey]) { div.textContent = "No hay servicios seleccionados."; return; }

  let html = "";
  const groups = {};

  Object.entries(selections[dateKey]).forEach(([key,val]) => {
    if (!val.selected) return;
    const [dog, service] = key.split('_');
    if (!groups[service]) groups[service] = [];
    groups[service].push(val.start + " ‚Üí " + val.end + " ‚Äî " + dog);
  });

  for (let s in groups) {
    html += `<strong>${s}</strong><br>`;
    groups[s].forEach(t => html += `‚Ä¢ ${t}<br>`);
    html += `<br>`;
  }

  div.innerHTML = html || "No hay servicios seleccionados.";
}
updateSummary();

/* VIEW TABLE */
viewTableBtn.onclick = ()=> location.href = "table.html";

</script>
</body>
</html>
