<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Servicios</title>

<meta name="theme-color" content="#e7e5d8" />
<link rel="icon" href="icons/dog-192.png" sizes="192x192" type="image/png" />

<style>
/* ===== GLOBAL ===== */
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto;background:#e7e5d8;min-height:100vh;padding:10px;}
.container{max-width:800px;margin:0 auto;padding:20px;}
h1,h2{text-align:center;color:#373e2e;}
button{cursor:pointer}

/* ===== DATE STRIP ===== */
.month-header{text-align:center;font-size:22px;font-weight:700;margin-bottom:10px;color:#303021;}
.date-strip{display:flex;overflow-x:auto;gap:18px;padding:15px 5px 20px;white-space:nowrap;scroll-snap-type:x mandatory;}
.date-strip::-webkit-scrollbar{display:none}
.date-item{flex:0 0 auto;display:flex;flex-direction:column;align-items:center;gap:6px;scroll-snap-align:center;}
.date-item .dayname{font-size:14px}
.date-item .circle{width:55px;height:55px;border-radius:50%;background:white;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700;}
.date-item.active .circle{background:#c1802a;color:white}

/* ===== SUMMARY ===== */
.summary{background:#d4cba8;padding:20px;border-radius:16px;margin-top:20px;margin-bottom:90px;}
.summary-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;font-size:14px}

/* ===== MODALS ===== */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.55);z-index:3000;}
.modal-content{background:white;height:100%;border-radius:22px 22px 0 0;padding:20px;overflow-y:auto;animation:slideUp .25s ease-out;}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}

/* ===== BUTTONS ===== */
.small-cancel{background:#5a5a5a;color:white;padding:10px 14px;border-radius:10px;border:none}
.small-save{background:#f2f2f2;padding:10px 14px;border-radius:10px;border:none}

/* ===== FOOTER ===== */
.footer-nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);height:60px;width:90%;max-width:480px;display:flex;justify-content:space-between;align-items:center;padding:0 25px;background:#303021;border-radius:9999px;z-index:1500}
.switch-btn{background:none;border:none;color:#c6d197;font-size:12px}

/* ===== FLOATING BTN ===== */
.floating-center-btn{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);width:60px;height:60px;border-radius:50%;background:#c1802a;border:none;font-size:36px;color:#c6d197;z-index:2500}
</style>
</head>

<body>

<div class="container">
  <h2 id="monthHeader" class="month-header"></h2>
  <div id="dateStrip" class="date-strip"></div>
  <div id="dailyTotal" style="text-align:center;font-weight:700;margin-top:10px"></div>
  <div class="summary">
    <div id="dailyAgenda"></div>
  </div>
</div>

<!-- SERVICE MODAL -->
<div id="serviceModal" class="modal">
  <div class="modal-content">
    <h2>Servicios del Día</h2>
    <div id="addedDogsContainer"></div>
    <select id="mainDogSelect">
      <option value="">Seleccionar Perro</option>
    </select>
    <button id="closeServiceModal" class="small-cancel">Cerrar</button>
  </div>
</div>

<!-- TARIFS MODAL -->
<div id="tarifsSheet" class="modal">
  <div class="modal-content">
    <h2>Tarifas</h2>
    <table id="tarifsTable" width="100%">
      <thead>
        <tr><th>Perro</th><th>Día</th><th>Noche</th><th>Paseo</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div style="display:flex;gap:10px;margin-top:20px">
      <button id="deleteTarifBtn" class="small-cancel">Eliminar</button>
      <button id="saveTarifsBtn" class="small-save">Guardar</button>
      <button id="cancelTarifsBtn" class="small-cancel">Cerrar</button>
    </div>
  </div>
</div>

<footer class="footer-nav">
  <button id="tarifsBtn" class="switch-btn">Tarifas</button>
  <button id="calendarBtn" class="switch-btn">Agenda</button>
</footer>

<button id="centralBtn" class="floating-center-btn">+</button>

<script>
/* ===== STATE ===== */
let currentDate = new Date();
const selections = JSON.parse(localStorage.getItem("selections")) || {};
const tarifs = JSON.parse(localStorage.getItem("tarifs")) || {};
const defaultDogs=["Nina","Carmela","Pancho","Pablo","Lili","Jugnia","Leo","India","Kimchi","Cuatri","Tristona y Belona","Neo","Briso","Zaspi","R&H"];

const dateStrip=document.getElementById("dateStrip");
const monthHeader=document.getElementById("monthHeader");

/* ===== DATE STRIP ===== */
const monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];
const dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

function buildDateStrip(){
  dateStrip.innerHTML="";
  for(let i=-30;i<=30;i++){
    const d=new Date();
    d.setDate(d.getDate()+i);
    const div=document.createElement("div");
    div.className="date-item"+(i===0?" active":"");
    div.innerHTML=`<div class="dayname">${dayNames[d.getDay()]}</div><div class="circle">${d.getDate()}</div>`;
    div.onclick=()=>{document.querySelectorAll(".date-item").forEach(x=>x.classList.remove("active"));div.classList.add("active");currentDate=d;updateMonth()};
    dateStrip.appendChild(div);
  }
}
function updateMonth(){monthHeader.textContent=`${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`}

/* ===== TARIFS ===== */
const tarifsSheet=document.getElementById("tarifsSheet");
const tarifsBody=document.querySelector("#tarifsTable tbody");

document.getElementById("tarifsBtn").onclick=()=>{renderTarifs();tarifsSheet.style.display="block"};
document.getElementById("cancelTarifsBtn").onclick=()=>tarifsSheet.style.display="none";
document.getElementById("saveTarifsBtn").onclick=()=>{localStorage.setItem("tarifs",JSON.stringify(tarifs));tarifsSheet.style.display="none"};

function renderTarifs(){
  tarifsBody.innerHTML="";
  Object.entries(tarifs).forEach(([dog,p])=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${dog}</td><td>${p.day||0}</td><td>${p.night||0}</td><td>${p.walk||0}</td>`;
    tarifsBody.appendChild(tr);
  });
}

/* ===== SERVICE MODAL ===== */
document.getElementById("centralBtn").onclick=()=>document.getElementById("serviceModal").style.display="block";
document.getElementById("closeServiceModal").onclick=()=>document.getElementById("serviceModal").style.display="none";

/* ===== INIT ===== */
buildDateStrip();
updateMonth();

    <!-- NESTED ADD SERVICE POPUP -->
<div id="addServicePopup" class="modal">
  <div class="modal-content">
    <h2>Añadir Servicio</h2>

    <label>Perro</label>
    <select id="dogSelect"></select>

    <label style="margin-top:12px">Servicios</label>
    <div id="serviceButtonsContainer"></div>

    <div id="timeInputsContainer" style="display:none;margin-top:12px">
      <label>Recogida</label>
      <input id="startTimeInput" type="time">
      <label>Entrega</label>
      <input id="endTimeInput" type="time">
    </div>

    <div style="display:flex;gap:10px;margin-top:20px">
      <button id="cancelServiceBtn" class="small-cancel">Cancelar</button>
      <button id="addServiceBtn" class="small-save">Guardar</button>
    </div>
  </div>
</div>

<!-- AGENDA MODAL -->
<div id="agendaSheet" class="modal">
  <div class="modal-content">
    <h2>Agenda Completa</h2>
    <div id="agendaContainer"></div>
    <button id="closeAgendaBtn" class="small-cancel">Cerrar</button>
  </div>
</div>
/* ===== SERVICE POPUP ===== */
const addServicePopup = document.getElementById("addServicePopup");
const dogSelect = document.getElementById("dogSelect");
const serviceButtonsContainer = document.getElementById("serviceButtonsContainer");
const timeInputsContainer = document.getElementById("timeInputsContainer");

let currentDogSelection = { dog:null, services:[], start:"", end:"" };

const SERVICES = ["Guardería","Paseo","+1 Noche","Otro servicio"];

function openAddService(dog){
  currentDogSelection = { dog, services:[], start:"", end:"" };
  dogSelect.innerHTML = `<option>${dog}</option>`;
  serviceButtonsContainer.innerHTML = "";
  timeInputsContainer.style.display = "none";
  SERVICES.forEach(s=>{
    const b=document.createElement("button");
    b.textContent=s;
    b.className="small-save";
    b.onclick=()=>{
      b.classList.toggle("active");
      const i=currentDogSelection.services.indexOf(s);
      i>-1?currentDogSelection.services.splice(i,1):currentDogSelection.services.push(s);
      timeInputsContainer.style.display =
        currentDogSelection.services.some(x=>x!="+1 Noche")?"block":"none";
    };
    serviceButtonsContainer.appendChild(b);
  });
  addServicePopup.style.display="block";
}

document.getElementById("cancelServiceBtn").onclick=()=>addServicePopup.style.display="none";

document.getElementById("addServiceBtn").onclick=()=>{
  if(!currentDogSelection.services.length) return alert("Selecciona un servicio");
  const dateKey=formatDate(currentDate);
  selections[dateKey]=selections[dateKey]||{};
  currentDogSelection.start=startTimeInput.value;
  currentDogSelection.end=endTimeInput.value;
  currentDogSelection.services.forEach(s=>{
    selections[dateKey][`${currentDogSelection.dog}_${s}`]={
      selected:true,start:currentDogSelection.start,end:currentDogSelection.end
    };
  });
  localStorage.setItem("selections",JSON.stringify(selections));
  addServicePopup.style.display="none";
  updateSummary();
};

/* ===== AGENDA ===== */
const agendaSheet=document.getElementById("agendaSheet");
const agendaContainer=document.getElementById("agendaContainer");

document.getElementById("calendarBtn").onclick=()=>{
  agendaContainer.innerHTML="";
  Object.keys(selections).sort().forEach(k=>{
    const d=document.createElement("div");
    d.innerHTML=`<h3>${k}</h3>`;
    Object.entries(selections[k]).forEach(([key,val])=>{
      if(!val.selected) return;
      const [dog,svc]=key.split("_");
      const p=document.createElement("div");
      p.textContent=`${val.start||""} ${dog} ${svc}`;
      d.appendChild(p);
    });
    agendaContainer.appendChild(d);
  });
  agendaSheet.style.display="block";
};
document.getElementById("closeAgendaBtn").onclick=()=>agendaSheet.style.display="none";

/* ===== DAILY SUMMARY + TOTAL ===== */
function formatDate(d){
  return `${String(d.getDate()).padStart(2,"0")}/${String(d.getMonth()+1).padStart(2,"0")}/${d.getFullYear()}`;
}

function updateSummary(){
  const key=formatDate(currentDate);
  const box=document.getElementById("dailyAgenda");
  const totalEl=document.getElementById("dailyTotal");
  box.innerHTML="";
  let total=0;

  const entries=Object.entries(selections[key]||{})
    .filter(([_,v])=>v.selected)
    .map(([k,v])=>{
      const [dog,svc]=k.split("_");
      return {...v,dog,svc};
    })
    .sort((a,b)=>(a.start||"").localeCompare(b.start||""));

  if(!entries.length){
    box.innerHTML="<p>Sin servicios.</p>";
    totalEl.textContent="";
    return;
  }

  entries.forEach(e=>{
    const div=document.createElement("div");
    div.textContent=`${e.start||""} ${e.dog} ${e.svc}`;
    box.appendChild(div);

    const t=tarifs[e.dog]||{};
    if(e.svc==="Guardería") total+=Number(t.day||0);
    if(e.svc==="Paseo") total+=Number(t.walk||0);
    if(e.svc==="+1 Noche") total+=Number(t.night||0);
  });

  totalEl.textContent=`Total del día: ${total}€`;
}

/* ===== HOOK DOG SELECT ===== */
document.getElementById("mainDogSelect").onchange=e=>{
  if(e.target.value) openAddService(e.target.value);
};
</script>
</body>
</html>
