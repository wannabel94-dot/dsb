<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Servicios</title>
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#c1802a" />
<link rel="icon" href="icons/dog-192.png" sizes="192x192" type="image/png" />
// #
061400 #303021 #a53200 33712db8a162
#c6d197 //
<style>
* { box-sizing: border-box; margin:0; padding:0; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto; background:#c6d197; padding:20px; min-height:100vh; }
.container{max-width:800px;margin:0;padding:30px;}
h1{text-align:center;margin-bottom:20px;color:#373e2e;}
.date-controls{display:flex;justify-content:center;gap:10px;margin-bottom:20px;}
.date-btn,.date-nav{padding:12px 20px;border:none;border-radius:10px;font-weight:600;cursor:pointer;}
.date-btn{background:#303021;color:white;}
.date-nav{background:white;color:#303021;}
  #addServiceBtn {
  padding: 12px 24px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 12px;
  border: none;
  background: linear-gradient(135deg, #c1802a 0%, #a86d1f 100%);
  color: white;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(193, 128, 42, 0.3);
  transition: all 0.3s ease;
}
#addServiceBtn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(193, 128, 42, 0.5);
  background: #a53200;
}
button{cursor:pointer;}
.summary{background:#d4cba8;padding:20px;border-radius:16px;border:2px solid #8a8252;margin-top:20px;}
#summaryContent{line-height:1.6;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;}
.modal-content{background:white;padding:25px;border-radius:16px;max-width:400px;width:90%;max-height:80vh;overflow:auto;}
.modal-buttons{display:flex;justify-content:flex-end;gap:10px;margin-top:15px;}
label{display:block;margin-top:10px;}
select,multi-select,input{width:100%;padding:8px;margin-top:5px;border-radius:6px;border:1px solid #8a8252;}
</style>
</head>
<body>
<div class="container">
<h1>Buen dia!</h1>
<div class="date-controls">
  <button id="prevDay" class="date-nav">&lt;</button>
  <button id="dateBtn" class="date-btn"></button>
  <button id="nextDay" class="date-nav">&gt;</button>
</div>
<div style="text-align:center;margin-bottom:15px;">
  <button id="addServiceBtn">+ Añadir Servicio</button>
</div>
<div class="summary">
  <h3>Agenda:</h3>
  <div id="summaryContent">No hay servicios seleccionados.</div>
</div>
</div>

<!-- Modal -->
<div id="serviceModal" class="modal">
  <div class="modal-content" id="modalContent">
    <h2>Seleccionar Perro</h2>
    <select id="dogSelect"></select>
    <div class="modal-buttons" id="serviceModalButtons">
      <button id="nextStepBtn">Siguiente</button>
      <button id="closeModalBtn">Cancelar</button>
    </div>
  </div>
</div>

<!-- Time Modal -->
<div id="timeModal" class="modal">
  <div class="modal-content">
    <h2>Horario</h2>
    <label>Inicio:</label>
    <input id="startTimeInput" type="time" />
    <label>Fin:</label>
    <input id="endTimeInput" type="time" />
    <div class="modal-buttons">
      <button id="saveTimeBtn">Guardar</button>
      <button id="closeTimeModal">Cancelar</button>
    </div>
  </div>
</div>

<script>
const defaultDogs = ["PABLO","LILI","JUGNIA","LEO","INDIA","KIMCHI","NINA","CARMELA","CUATRI","TB","NEO","BRISO","ZOZI","R&H"];
let allDogs = JSON.parse(localStorage.getItem('allDogs')) || defaultDogs;
let selections = JSON.parse(localStorage.getItem('selections')) || {};
let currentDate = new Date();
const formatDate = d => `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;
function updateDate(){ document.getElementById('dateBtn').textContent = formatDate(currentDate); }
updateDate();
prevDay.onclick = ()=>{ currentDate.setDate(currentDate.getDate()-1); updateDate(); updateSummary(); };
nextDay.onclick = ()=>{ currentDate.setDate(currentDate.getDate()+1); updateDate(); updateSummary(); };
dateBtn.onclick = ()=>{
  const input=document.createElement('input'); input.type='date'; input.style.display='none'; document.body.appendChild(input);
  input.valueAsDate=currentDate; input.click();
  input.onchange=()=>{ currentDate=new Date(input.value); updateDate(); updateSummary(); input.remove(); };
};

const serviceModal = document.getElementById('serviceModal');
const dogSelect = document.getElementById('dogSelect');
const serviceModalButtons = document.getElementById('serviceModalButtons');
let tempSelection = {dog:null,services:[],start:'',end:''};

addServiceBtn.onclick = ()=>{
  dogSelect.innerHTML='';
  allDogs.forEach(d=>{
    const opt=document.createElement('option'); opt.value=d; opt.textContent=d; dogSelect.appendChild(opt);
  });
  document.querySelector('#modalContent h2').textContent='Seleccionar Perro';
  document.getElementById('nextStepBtn').style.display='inline';
  serviceModal.style.display='flex';
};

nextStepBtn.onclick = ()=>{
  tempSelection.dog = dogSelect.value;
  document.querySelector('#modalContent h2').textContent='Seleccionar Servicios';
  dogSelect.style.display='none';
  nextStepBtn.style.display='none';

  // Remove previous checkboxes or continue buttons
  document.querySelectorAll('#modalContent label, #modalContent .continueBtn').forEach(e=>e.remove());

  const services = ['Daycare','Overnight','Walk'];
  services.forEach(s=>{
    const label = document.createElement('label');
    label.innerHTML=`<input type='checkbox' value='${s}'> ${s}`;
    document.querySelector('#modalContent').appendChild(label);
  });

  const continueBtn = document.createElement('button');
  continueBtn.textContent='Siguiente';
  continueBtn.classList.add('continueBtn');
  continueBtn.onclick=()=>{
    const selected = [...document.querySelectorAll('#modalContent input[type=checkbox]:checked')].map(i=>i.value);
    if(selected.length===0){alert('Selecciona al menos un servicio'); return;}
    tempSelection.services = selected;
    serviceModal.style.display='none';
    document.getElementById('startTimeInput').value='';
    document.getElementById('endTimeInput').value='';
    timeModal.style.display='flex';
  };
  document.querySelector('#modalContent').appendChild(continueBtn);
};

closeModalBtn.onclick = ()=>{serviceModal.style.display='none';};

saveTimeBtn.onclick=()=>{
  tempSelection.start=document.getElementById('startTimeInput').value;
  tempSelection.end=document.getElementById('endTimeInput').value;
  const dateKey=formatDate(currentDate);
  if(!selections[dateKey]) selections[dateKey]={};
  tempSelection.services.forEach(s=>{
    selections[dateKey][`${tempSelection.dog}_${s}`]={selected:true,start:tempSelection.start,end:tempSelection.end};
  });
  localStorage.setItem('selections',JSON.stringify(selections));
  timeModal.style.display='none';
  updateSummary();
};

closeTimeModal.onclick=()=>{timeModal.style.display='none';};

function updateSummary(){
  const dateKey=formatDate(currentDate);
  const div=document.getElementById('summaryContent');
  if(!selections[dateKey]){div.textContent='No hay servicios seleccionados.'; return;}
  let html='';
  const groups={};
  Object.entries(selections[dateKey]).forEach(([key,val])=>{
    if(!val.selected) return;
    const [dog,service]=key.split('_');
    if(!groups[dog]) groups[dog]=[];
    groups[dog].push(`${service}: ${val.start} → ${val.end}`);
  });
  for(let dog in groups){
    html+=`<strong>${dog}</strong><br>`;
    groups[dog].forEach(s=>{html+=`• ${s}<br>`;});
    html+='<br>';
  }
  div.innerHTML=html||'No hay servicios seleccionados.';
}
updateSummary();
</script>
</body>
</html>
