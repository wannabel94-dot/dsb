<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dog Services Dashboard</title>
<style>
  body {font-family: Arial, sans-serif; background: #eef2f7; margin:0; padding:0;}
  .container {max-width: 1600px; margin: 20px auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.08);}
  h1 {margin-bottom: 20px; font-size: 28px; color: #333;}
  .date-controls {display: flex; align-items: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;}
  .date-btn, .date-nav, #ratesBtn {padding: 10px 18px; font-size: 16px; cursor: pointer; border-radius:6px; border:1px solid #ccc; background:#fff; transition:0.2s;}
  .date-btn:hover, .date-nav:hover, #ratesBtn:hover {background:#f0f4f8;}
  .totals {margin-left:20px; font-weight:bold; font-size:16px;}
  .totals span {margin-right:15px; color:green;}
  .dropdowns {display:flex; gap:20px; margin-bottom:20px;}
  .dropdown {position: relative; display: inline-block;}
  .dropdown button {width: 160px; text-align:left; border:1px solid #ccc; border-radius:6px; background:#fff; padding:10px;}
  .dropdown-content {display: none; position: absolute; background-color: #f9f9f9; min-width: 180px; box-shadow: 0px 4px 12px rgba(0,0,0,0.15); z-index: 1; border-radius: 8px; max-height: 300px; overflow-y: auto; margin-top:5px;}
  .dropdown-content button {display: block; width: 100%; border: none; background: none; padding: 8px 12px; text-align: left; cursor: pointer; border-radius: 5px; transition:0.2s;}
  .dropdown-content button:hover {background:#2b6cb0; color:#fff;}
  .dropdown-content button.selected {background:#2b6cb0; color:#fff;}
  table {width:100%; border-collapse: collapse; margin-top:20px; font-size:14px;}
  th, td {padding:10px; border:1px solid #ddd; text-align:right;}
  th {background:#f1f5f9; text-align:left; font-weight:600;}
  td.currency {white-space: nowrap;}
  td.weekday {text-align:center; font-weight:500; color:#555;}
  tr.weekend {background-color:#fff3e0;}
  .edit-btn {background:#f0ad4e; color:#fff; border:none; border-radius:5px; cursor:pointer; padding:5px 10px;}
  .edit-btn:hover {background:#ec971f;}
  /* Modals */
  .modal {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;}
  .modal-content {background:#fff; padding:20px; border-radius:10px; max-width:800px; max-height:80%; overflow-y:auto;}
  .modal-content table {width:100%; border-collapse: collapse;}
  .modal-content th, .modal-content td {border:1px solid #ccc; padding:8px; text-align:center;}
  .modal-content input {width:60px;}
  .modal-content button {margin-top:10px; margin-right:5px; padding:8px 12px; cursor:pointer;}
</style>
</head>
<body>
<div class="container">
  <h1>Dog Services Dashboard</h1>

  <div class="date-controls">
    <button id="prevDay" class="date-nav">&lt;</button>
    <button id="dateBtn" class="date-btn"></button>
    <button id="nextDay" class="date-nav">&gt;</button>
    <div class="totals">
      <span id="dailyTotal">Daily: 0 €</span>
      <span id="weeklyTotal">Weekly: 0 €</span>
      <span id="monthlyTotal">Monthly: 0 €</span>
    </div>
    <button id="ratesBtn">Rates</button>
  </div>

  <div class="dropdowns" id="serviceDropdowns"></div>

  <table id="paymentTable">
    <thead>
      <tr>
        <th>Día</th>
        <th>Fecha</th>
        <th>Total (€)</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<!-- Rates Modal -->
<div id="ratesModal" class="modal">
  <div class="modal-content">
    <h2>Dog Rates (€)</h2>
    <table id="ratesTable">
      <thead>
        <tr>
          <th>Dog</th>
          <th>Daycare</th>
          <th>Weekend</th>
          <th>Overnight</th>
          <th>Walk</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="addDogRateBtn">Add Dog</button>
    <button id="saveRates">Save</button>
    <button id="closeRates">Close</button>
  </div>
</div>

<!-- Edit Row Modal -->
<div id="editRowModal" class="modal">
  <div class="modal-content">
    <h2>Edit Date Entries</h2>
    <table id="editRowTable">
      <thead>
        <tr>
          <th>Dog</th><th>Value (€)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="saveEditRow">Save</button>
    <button id="closeEditRow">Close</button>
  </div>
</div>

<script>
const spanishDays = ['Dom.','Lun.','Mar.','Mié.','Jue.','Vie.','Sáb.'];

let dogNames = ["PABLO","LILI","JUGNIA","LEO","INDIA","KIMCHI","NINA","CARMELA","CUATRI","TB","NEO","BRISO","ZOZI","R&H"];
let allDogs = [...dogNames];
let rows = [];
let selections = {};
let rates = {};
allDogs.forEach(d => rates[d]={daycare:10, weekend:12, overnight:20, walk:5});

let currentDate = new Date();
const dateBtn=document.getElementById('dateBtn');
const tbody=document.getElementById('tableBody');
const serviceDropdowns=document.getElementById('serviceDropdowns');
const dailyTotalSpan = document.getElementById('dailyTotal');
const weeklyTotalSpan = document.getElementById('weeklyTotal');
const monthlyTotalSpan = document.getElementById('monthlyTotal');

function formatDate(d){ const dd=String(d.getDate()).padStart(2,'0'); const mm=String(d.getMonth()+1).padStart(2,'0'); const yyyy=d.getFullYear(); return `${dd}/${mm}/${yyyy}`; }
function getWeekday(d){ return spanishDays[d.getDay()]; }

function updateDateBtn(){ 
  dateBtn.textContent=formatDate(currentDate); 
  updateTotals();
}

function updateTotals(){
  const dateStr=formatDate(currentDate);
  const row = rows.find(r=>r.Fecha===dateStr);
  dailyTotalSpan.textContent = 'Daily: '+(row?row.Total.toFixed(2):'0')+' €';

  // Weekly total
  let startWeek = new Date(currentDate);
  startWeek.setDate(currentDate.getDate() - ((currentDate.getDay()+6)%7));
  let weekSum = rows.filter(r=>{
    let d = r.Fecha.split('/'); 
    let rDate = new Date(d[2],d[1]-1,d[0]);
    return rDate>=startWeek && rDate<=currentDate;
  }).reduce((a,b)=>a+b.Total,0);
  weeklyTotalSpan.textContent = 'Weekly: '+weekSum.toFixed(2)+' €';

  // Monthly total
  let startMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
  let monthSum = rows.filter(r=>{
    let d = r.Fecha.split('/');
    let rDate = new Date(d[2],d[1]-1,d[0]);
    return rDate>=startMonth && rDate<=currentDate;
  }).reduce((a,b)=>a+b.Total,0);
  monthlyTotalSpan.textContent = 'Monthly: '+monthSum.toFixed(2)+' €';
}

// Create service dropdowns
function createServiceDropdowns(){
  serviceDropdowns.innerHTML='';
  ['Daycare','Walk','Overnight'].forEach(service=>{
    const div=document.createElement('div'); div.classList.add('dropdown');
    const btn=document.createElement('button'); btn.textContent=service;
    div.appendChild(btn);

    const content=document.createElement('div'); content.classList.add('dropdown-content');
    allDogs.forEach(dog=>{
      const dogBtn=document.createElement('button'); dogBtn.textContent=dog;
      dogBtn.addEventListener('click', e=>{
        e.stopPropagation();
        toggleDogSelection(dog,service,dogBtn);
      });
      content.appendChild(dogBtn);
    });
    div.appendChild(content);
    serviceDropdowns.appendChild(div);

    btn.addEventListener('click', e=>{
      e.stopPropagation();
      const isVisible = content.style.display==='block';
      closeAllDropdowns();
      content.style.display = isVisible ? 'none':'block';
    });
  });
}

function closeAllDropdowns(){
  document.querySelectorAll('.dropdown-content').forEach(dc=> dc.style.display='none');
}
document.addEventListener('click', closeAllDropdowns);

function toggleDogSelection(dog,service,btn){
  const dateStr=formatDate(currentDate);
  if(!selections[dateStr]) selections[dateStr]={};
  const key=`${dog}_${service}`;
  const selected=!selections[dateStr][key];
  selections[dateStr][key]=selected;
  btn.classList.toggle('selected',selected);
  updateDogPayment(dog,service,selected);
}

function updateDogPayment(dog,service,add=true){
  const dateStr=formatDate(currentDate);
  let row = rows.find(r=>r.Fecha===dateStr);
  if(!row){ 
    row={Fecha:dateStr,Día:getWeekday(currentDate),Total:0,services:{}};
    rows.push(row);
  }
  if(!row.services[dog]) row.services[dog]=0;
  let rate = rates[dog][service.toLowerCase()];
  if(service==='Daycare' && (currentDate.getDay()===0 || currentDate.getDay()===6)) rate=rates[dog].weekend;
  row.services[dog] = add ? row.services[dog]+rate : Math.max(0,row.services[dog]-rate);
  row.Total=Object.values(row.services).reduce((a,b)=>a+b,0);
  updateTotals();
  buildTable();
}

function buildTable(){
  tbody.innerHTML='';
  const tableHead=document.querySelector('#paymentTable thead tr');
  tableHead.innerHTML=`<th>Día</th><th>Fecha</th><th>Total (€)</th>`;
  allDogs.forEach(d=>{ const th=document.createElement('th'); th.textContent=d; tableHead.appendChild(th); });
  tableHead.appendChild(document.createElement('th')).textContent='Editar';

  rows.sort((a,b)=>new Date(a.Fecha.split('/').reverse().join('-'))-new Date(b.Fecha.split('/').reverse().join('-')));
  rows.forEach(r=>{
    const tr=document.createElement('tr');
    const dateParts=r.Fecha.split('/'); 
    const rowDate=new Date(dateParts[2],dateParts[1]-1,dateParts[0]);
    if(rowDate.getDay()===0 || rowDate.getDay()===6) tr.classList.add('weekend');
    tr.innerHTML=`<td class="weekday">${r.Día}</td><td>${r.Fecha}</td><td>${r.Total.toFixed(2)}</td>`;
    allDogs.forEach(d=>{ 
      const td=document.createElement('td'); 
      td.textContent=(r.services[d]||''); 
      td.classList.add('currency'); 
      tr.appendChild(td); 
    });
    // Edit button
    const tdEdit = document.createElement('td');
    const editBtn = document.createElement('button');
    editBtn.classList.add('edit-btn');
    editBtn.textContent='Editar';
    editBtn.onclick = ()=>openEditRowModal(r);
    tdEdit.appendChild(editBtn);
    tr.appendChild(tdEdit);
    tbody.appendChild(tr);
  });
}

// Edit row modal logic
const editRowModal = document.getElementById('editRowModal');
const editRowTableBody = document.querySelector('#editRowTable tbody');
let editingRow = null;

function openEditRowModal(row){
  editingRow = row;
  editRowTableBody.innerHTML='';
  allDogs.forEach(d=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${d}</td><td><input type="number" value="${row.services[d]||0}" min="0"></td>`;
    editRowTableBody.appendChild(tr);
  });
  editRowModal.style.display='flex';
}

document.getElementById('closeEditRow').addEventListener('click',()=>{ editRowModal.style.display='none'; });

document.getElementById('saveEditRow').addEventListener('click',()=>{
  const inputs = editRowTableBody.querySelectorAll('input');
  allDogs.forEach((d,i)=>{
    const val = parseFloat(inputs[i].value)||0;
    if(val===0) delete editingRow.services[d];
    else editingRow.services[d]=val;
  });
  editingRow.Total=Object.values(editingRow.services).reduce((a,b)=>a+b,0);
  updateTotals();
  buildTable();
  editRowModal.style.display='none';
});

// Date controls
document.getElementById('prevDay').addEventListener('click',()=>{
  currentDate.setDate(currentDate.getDate()-1); updateDateBtn(); restoreSelections();
});
document.getElementById('nextDay').addEventListener('click',()=>{
  currentDate.setDate(currentDate.getDate()+1); updateDateBtn(); restoreSelections();
});
dateBtn.addEventListener('click',()=>{ 
  const dateInput = document.createElement('input'); 
  dateInput.type='date'; dateInput.style.display='none';
  document.body.appendChild(dateInput);
  dateInput.valueAsDate=currentDate;
  dateInput.click();
  dateInput.addEventListener('change',()=>{ 
    currentDate=new Date(dateInput.value); updateDateBtn(); restoreSelections(); 
    document.body.removeChild(dateInput);
  });
});

// Restore selections per current date
function restoreSelections(){
  const dateStr=formatDate(currentDate);
  document.querySelectorAll('.dropdown-content button').forEach(btn=>{
    const dog = btn.textContent;
    const service = btn.closest('.dropdown').querySelector('button').textContent;
    const key = `${dog}_${service}`;
    btn.classList.toggle('selected', selections[dateStr] && selections[dateStr][key]);
  });
}

updateDateBtn();
createServiceDropdowns();
buildTable();
</script>
</body>
</html>
