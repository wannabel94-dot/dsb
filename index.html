<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dog Daycare Tracker</title>
<style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f4f4f4; }
    h1 { margin-bottom: 10px; }
    button { padding: 8px 12px; margin: 5px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #333; color: white; }
    .modal {
        display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.6); justify-content: center; align-items: center;
    }
    .modal-content {
        background: white; padding: 20px; width: 600px; border-radius: 8px;
        max-height: 80vh; overflow-y: auto;
    }
    .close { float: right; cursor: pointer; font-size: 22px; }
    input[type="number"] { width: 70px; }
</style>
</head>

<body>

<h1>Dog Daycare Tracker</h1>
<button id="addDateBtn">Add Date</button>
<button id="ratesBtn">Rates</button>

<table id="mainTable">
    <thead>
        <tr>
            <th>Date</th>
            <th>Dog</th>
            <th>Daycare</th>
            <th>Weekend</th>
            <th>Overnight</th>
            <th>Walk</th>
            <th>Total</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<!-- RATES MODAL -->
<div id="ratesModal" class="modal">
    <div class="modal-content">
        <span id="closeRates" class="close">&times;</span>
        <h2>Dog Rates</h2>
        <table id="ratesTable">
            <thead>
                <tr>
                    <th>Dog</th>
                    <th>Daycare</th>
                    <th>Weekend</th>
                    <th>Overnight</th>
                    <th>Walk</th>
                    <th>Remove</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <button id="addDogRateBtn">Add Dog</button>
        <button id="saveRates">Save Rates</button>
    </div>
</div>

<script>
// =========================
// LOCAL STORAGE SETUP
// =========================
let data = JSON.parse(localStorage.getItem("dogData") || "[]");
let rates = JSON.parse(localStorage.getItem("dogRates") || "{}");

let allDogs = Object.keys(rates);

// =========================
// SAVE FUNCTION
// =========================
function saveData() {
    localStorage.setItem("dogData", JSON.stringify(data));
    localStorage.setItem("dogRates", JSON.stringify(rates));
}

// =========================
// BUILD MAIN TABLE
// =========================
function buildTable() {
    const tbody = document.querySelector("#mainTable tbody");
    tbody.innerHTML = "";

    data.forEach((entry, index) => {
        const tr = document.createElement("tr");

        const dogRate = rates[entry.dog] || { daycare: 0, weekend: 0, overnight: 0, walk: 0 };

        const total =
            (entry.daycare ? dogRate.daycare : 0) +
            (entry.weekend ? dogRate.weekend : 0) +
            (entry.overnight ? dogRate.overnight : 0) +
            (entry.walk ? dogRate.walk : 0);

        tr.innerHTML = `
            <td><input type="date" value="${entry.date}"></td>
            <td>
                <select>
                    ${allDogs.map(d => `<option ${entry.dog === d ? "selected" : ""}>${d}</option>`).join("")}
                </select>
            </td>
            <td><input type="checkbox" ${entry.daycare ? "checked" : ""}></td>
            <td><input type="checkbox" ${entry.weekend ? "checked" : ""}></td>
            <td><input type="checkbox" ${entry.overnight ? "checked" : ""}></td>
            <td><input type="checkbox" ${entry.walk ? "checked" : ""}></td>
            <td>$${total.toFixed(2)}</td>
            <td><button class="deleteRow">X</button></td>
        `;

        // EVENT LISTENERS
        const inputs = tr.querySelectorAll("input, select");
        inputs.forEach((input) => {
            input.addEventListener("change", () => {
                entry.date = tr.children[0].children[0].value;
                entry.dog = tr.children[1].children[0].value;
                entry.daycare = tr.children[2].children[0].checked;
                entry.weekend = tr.children[3].children[0].checked;
                entry.overnight = tr.children[4].children[0].checked;
                entry.walk = tr.children[5].children[0].checked;
                saveData();
                buildTable();
            });
        });

        tr.querySelector(".deleteRow").addEventListener("click", () => {
            data.splice(index, 1);
            saveData();
            buildTable();
        });

        tbody.appendChild(tr);
    });
}

// =========================
// ADD DATE ENTRY
// =========================
document.getElementById("addDateBtn").addEventListener("click", () => {
    if (allDogs.length === 0) return alert("Add dogs in the Rates menu first!");

    data.push({
        date: new Date().toISOString().split("T")[0],
        dog: allDogs[0],
        daycare: false,
        weekend: false,
        overnight: false,
        walk: false
    });

    saveData();
    buildTable();
});

// =========================
// RATES MODAL FUNCTIONALITY
// =========================

const ratesModal = document.getElementById("ratesModal");
const ratesTableBody = document.querySelector("#ratesTable tbody");

// OPEN
document.getElementById("ratesBtn").addEventListener("click", () => {
    buildRatesTable();
    ratesModal.style.display = "flex";
});

// CLOSE
document.getElementById("closeRates").addEventListener("click", () => {
    ratesModal.style.display = "none";
});

// BUILD RATES TABLE
function buildRatesTable() {
    ratesTableBody.innerHTML = "";
    allDogs = Object.keys(rates);

    allDogs.forEach(dog => {
        const r = rates[dog];
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${dog}</td>
            <td><input type="number" value="${r.daycare}"></td>
            <td><input type="number" value="${r.weekend}"></td>
            <td><input type="number" value="${r.overnight}"></td>
            <td><input type="number" value="${r.walk}"></td>
            <td><button class="delDog">Delete</button></td>
        `;

        tr.querySelector(".delDog").addEventListener("click", () => {
            delete rates[dog];
            allDogs = Object.keys(rates);
            saveData();
            buildRatesTable();
            buildTable();
        });

        ratesTableBody.appendChild(tr);
    });
}

// SAVE RATES
document.getElementById("saveRates").addEventListener("click", () => {
    [...ratesTableBody.children].forEach(tr => {
        const dog = tr.children[0].textContent;
        const inputs = tr.querySelectorAll("input");

        rates[dog] = {
            daycare: parseFloat(inputs[0].value) || 0,
            weekend: parseFloat(inputs[1].value) || 0,
            overnight: parseFloat(inputs[2].value) || 0,
            walk: parseFloat(inputs[3].value) || 0
        };
    });

    saveData();
    buildTable();
    ratesModal.style.display = "none";
});

// ADD NEW DOG
document.getElementById("addDogRateBtn").addEventListener("click", () => {
    const name = prompt("Enter dog name:");
    if (!name) return;
    if (rates[name]) return alert("Dog already exists!");

    rates[name] = { daycare: 10, weekend: 12, overnight: 20, walk: 5 };
    saveData();
    buildRatesTable();
    buildTable();
});

buildTable();
</script>
</body>
</html>
