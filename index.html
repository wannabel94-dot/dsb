<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dog Attendance / Payments</title>
<style>
  body {font-family: Arial, sans-serif; padding: 20px; background: #f7fafc;}
  .container {max-width: 1400px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); overflow-x:auto;}
  h1 {margin-bottom: 12px;}
  .date-controls {display: flex; align-items: center; gap: 10px; margin-bottom: 18px;}
  .date-btn, .date-nav {padding: 10px 18px; font-size: 16px; cursor: pointer;}
  .service-columns {display: flex; gap: 20px; margin-bottom: 18px;}
  .service-column {flex: 1;}
  .service-column h3 {margin-bottom: 8px;}
  .dog-buttons {display: grid; grid-template-columns: repeat(1, 1fr); gap: 10px;}
  .dog-buttons button {padding: 8px 14px; cursor: pointer; border-radius: 8px; border: 1px solid #888; background: #e2e8f0;}
  .dog-buttons button.active {background: #2b6cb0; color: #fff;}
  .dropdown {position: relative; display: inline-block; margin-bottom: 18px;}
  .dropdown-content {display: none; position: absolute; background-color: #f9f9f9; min-width: 180px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 1; border-radius: 8px;}
  .dropdown-content div {padding: 8px 12px;}
  .dropdown-content input {width: 50px; margin-left:5px;}
  .dropdown:hover .dropdown-content {display: block;}
  #ratesBtn {padding: 10px 18px; font-size: 16px; margin-left:10px; cursor:pointer;}
  table {width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; min-width: 1400px;}
  th, td {padding: 8px; border: 1px solid #ddd; text-align: right;}
  th {background: #f1f5f9; text-align: left;}
  td.currency {white-space: nowrap;}
  .weekend {background-color: #fff3e0;}
  /* Modal */
  #ratesModal {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;}
  #ratesModalContent {background:#fff; padding:20px; border-radius:10px; max-width:600px;}
  #ratesModalContent label {display:block; margin-bottom:5px;}
  #ratesModalContent input {width:60px; margin-left:5px;}
  #ratesModalContent button {margin-top:10px; margin-right:5px;}
</style>
</head>
<body>
<div class="container">
  <h1>Dog Attendance / Payments</h1>

  <div class="date-controls">
    <button id="prevDay" class="date-nav">&lt;</button>
    <button id="dateBtn" class="date-btn"></button>
    <button id="nextDay" class="date-nav">&gt;</button>
    <input type="date" id="dateInput" style="display:none; margin-left:10px;" />
    <button id="ratesBtn">Rates</button>
  </div>

  <div class="service-columns">
    <div class="service-column">
      <h3>Daycare</h3>
      <div class="dog-buttons" id="daycareButtons"></div>
    </div>
    <div class="service-column">
      <h3>Walk</h3>
      <div class="dog-buttons" id="walkButtons"></div>
    </div>
    <div class="service-column">
      <h3>Overnight</h3>
      <div class="dog-buttons" id="overnightButtons"></div>
    </div>
  </div>

  <div class="dropdown">
    <button>Extras ▼</button>
    <div class="dropdown-content" id="extrasDropdown"></div>
  </div>

  <table id="paymentTable">
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Total</th>
        <th>PABLO</th>
        <th>LILI</th>
        <th>JUGNIA</th>
        <th>LEO</th>
        <th>INDIA</th>
        <th>CHUFI</th>
        <th>CUSCO</th>
        <th>KIMCHI</th>
        <th>NINA</th>
        <th>CARMELA</th>
        <th>LUPE</th>
        <th>CUATRI</th>
        <th>TB</th>
        <th>NEO</th>
        <th>BRISO</th>
        <th>ZOZI</th>
        <th>R&H</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<!-- Rates Modal -->
<div id="ratesModal">
  <div id="ratesModalContent">
    <h2>Set Dog Rates (€)</h2>
    <div id="ratesInputs"></div>
    <button id="saveRates">Save</button>
    <button id="closeRates">Close</button>
  </div>
</div>

<script>
const dogNames = ["PABLO","LILI","JUGNIA","LEO","INDIA","KIMCHI","NINA","CARMELA","CUATRI","TB","NEO","BRISO","ZOZI","R&H"];
const extraDogs = ["CHUFI","LUPE","CUSCO"];
let rows = [];

let rates = {};
dogNames.concat(extraDogs).forEach(d => rates[d]={daycare:10, weekend:12, overnight:20, walk:5});

let currentDate = new Date();
const dateBtn=document.getElementById('dateBtn');
const dateInput=document.getElementById('dateInput');
const daycareDiv=document.getElementById('daycareButtons');
const walkDiv=document.getElementById('walkButtons');
const overnightDiv=document.getElementById('overnightButtons');
const extrasDropdown=document.getElementById('extrasDropdown');
const tbody=document.getElementById('tableBody');
let activeButtons = {};

function formatDate(d){
  const dd = String(d.getDate()).padStart(2,'0');
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const yyyy = d.getFullYear();
  return `${dd}/${mm}/${yyyy}`;
}
function updateDateBtn(){ dateBtn.textContent=formatDate(currentDate); }
function resetActiveButtons(){ Object.values(activeButtons).forEach(btn=>btn.classList.remove('active')); activeButtons = {}; }

function createServiceButtons(){
  ['daycare','walk','overnight'].forEach(service=>{
    const container = service==='daycare'?daycareDiv:service==='walk'?walkDiv:overnightDiv;
    dogNames.forEach(name=>{
      const btn=document.createElement('button'); btn.textContent=name;
      btn.addEventListener('click',()=>{
        const adding = !btn.classList.contains('active');
        btn.classList.toggle('active');
        activeButtons[name]=btn;
        updateDogPayment(name, service, adding);
      });
      container.appendChild(btn);
    });
  });
}

function createExtrasDropdown(){
  extraDogs.forEach(name=>{
    const div = document.createElement('div');
    const label = document.createElement('label');
    const input = document.createElement('input');
    input.type='checkbox';
    input.addEventListener('change',()=>{
      const checked = input.checked;
      if(checked){ activeButtons[name]=null; updateDogPayment(name,'daycare',true); }
      else updateDogPayment(name,'daycare',false);
    });
    label.appendChild(input); label.appendChild(document.createTextNode(' '+name));
    div.appendChild(label); extrasDropdown.appendChild(div);
  });
}

function findRowByDate(dateStr){ return rows.find(r=>r.Fecha===dateStr); }

function updateDogPayment(dogName, service, add){
  const dateStr=formatDate(currentDate);
  let row=findRowByDate(dateStr);
  if(!row){ row={Fecha:dateStr,Total:0}; dogNames.concat(extraDogs).forEach(d=>row[d]=0); rows.push(row); }
  let rate = rates[dogName][service];
  if(service==='daycare' && (currentDate.getDay()===0 || currentDate.getDay()===6)) rate = rates[dogName].weekend;
  if(add){ row[dogName]+=rate; row.Total+=rate; } else{ row.Total-=Math.min(rate,row[dogName]); row[dogName]=Math.max(0,row[dogName]-rate); }
  row.Total=Math.max(0,row.Total);
  buildTable();
}

function buildTable(){
  tbody.innerHTML='';
  rows.sort((a,b)=>new Date(a.Fecha.split('/').reverse().join('-'))-new Date(b.Fecha.split('/').reverse().join('-')));
  rows.forEach(r=>{
    const tr=document.createElement('tr');
    const parts=r.Fecha.split('/'); const rowDate=new Date(parts[2],parts[1]-1,parts[0]);
    if(rowDate.getDay()===0 || rowDate.getDay()===6) tr.classList.add('weekend');
    const tdFecha=document.createElement('td'); tdFecha.textContent=r.Fecha; tr.appendChild(tdFecha);
    const tdTotal=document.createElement('td'); tdTotal.textContent=r.Total+' €'; tdTotal.classList.add('currency'); tr.appendChild(tdTotal);
    dogNames.concat(extraDogs).forEach(d=>{ const td=document.createElement('td'); td.textContent=r[d]||''; td.classList.add('currency'); tr.appendChild(td); });
    tbody.appendChild(tr);
  });
}

// Date input toggle
dateBtn.addEventListener('click',()=>{ dateInput.valueAsDate=currentDate; dateInput.style.display='inline-block'; });
dateInput.addEventListener('change',(e)=>{ currentDate=new Date(e.target.value); updateDateBtn(); dateInput.style.display='none'; resetActiveButtons(); buildTable(); });

// Prev/Next day buttons
document.getElementById('prevDay').addEventListener('click',()=>{ currentDate.setDate(currentDate.getDate()-1); updateDateBtn(); resetActiveButtons(); buildTable(); });
document.getElementById('nextDay').addEventListener('click',()=>{ currentDate.setDate(currentDate.getDate()+1); updateDateBtn(); resetActiveButtons(); buildTable(); });

// Rates modal
const ratesModal=document.getElementById('ratesModal');
const ratesInputsDiv=document.getElementById('ratesInputs');
function populateRatesModal(){
  ratesInputsDiv.innerHTML='';
  dogNames.concat(extraDogs).forEach(d=>{
    const div=document.createElement('div');
    div.innerHTML=`${d}: Daycare <input type='number' id='daycare_${d}' value='${rates[d].daycare}'> Weekend <input type='number' id='weekend_${d}' value='${rates[d].weekend}'> Overnight <input type='number' id='overnight_${d}' value='${rates[d].overnight}'> Walk <input type='number' id='walk_${d}' value='${rates[d].walk}'>`;
    ratesInputsDiv.appendChild(div);
  });
}
document.getElementById('ratesBtn').addEventListener('click',()=>{ populateRatesModal(); ratesModal.style.display='flex'; });
document.getElementById('closeRates').addEventListener('click',()=>{ ratesModal.style.display='none'; });
document.getElementById('saveRates').addEventListener('click',()=>{
  dogNames.concat(extraDogs).forEach(d=>{
    rates[d].daycare=parseFloat(document.getElementById('daycare_'+d).value)||0;
    rates[d].weekend=parseFloat(document.getElementById('weekend_'+d).value)||0;
    rates[d].overnight=parseFloat(document.getElementById('overnight_'+d).value)||0;
    rates[d].walk=parseFloat(document.getElementById('walk_'+d).value)||0;
  });
  ratesModal.style.display='none';
});

createServiceButtons();
createExtrasDropdown();
updateDateBtn();
buildTable();
</script>
</body>
</html>
