<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dog Services Dashboard</title>
<style>
  body {font-family: Arial, sans-serif; padding: 20px; background: #f7fafc;}
  .container {max-width: 1400px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); overflow-x:auto;}
  h1 {margin-bottom: 12px;}
  .date-controls {display: flex; align-items: center; gap: 10px; margin-bottom: 18px;}
  .date-btn, .date-nav {padding: 10px 18px; font-size: 16px; cursor: pointer;}
  .dropdown {position: relative; display: inline-block; margin-bottom: 18px; margin-right: 20px;}
  .dropdown button {padding: 10px 18px; cursor: pointer;}
  .dropdown-content {display: none; position: absolute; background-color: #f9f9f9; min-width: 180px; box-shadow: 0px 8px 16px rgba(0,0,0,0.2); z-index: 1; border-radius: 8px; max-height: 300px; overflow-y: auto;}
  .dropdown-content button {display: block; width: 100%; border: none; background: none; padding: 8px 12px; text-align: left; cursor: pointer; border-radius: 5px;}
  .dropdown-content button.active {background: #2b6cb0; color: #fff;}
  .service-label {margin-bottom: 5px; font-weight: bold;}
  #ratesBtn {padding: 10px 18px; font-size: 16px; margin-left:10px; cursor:pointer;}
  table {width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; min-width: 1400px;}
  th, td {padding: 8px; border: 1px solid #ddd; text-align: right;}
  th {background: #f1f5f9; text-align: left;}
  td.currency {white-space: nowrap;}
  .weekend {background-color: #fff3e0;}
  /* Modal */
  #ratesModal {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;}
  #ratesModalContent {background:#fff; padding:20px; border-radius:10px; max-width:600px;}
  #ratesModalContent label {display:block; margin-bottom:5px;}
  #ratesModalContent input {width:60px; margin-left:5px;}
  #ratesModalContent button {margin-top:10px; margin-right:5px;}
</style>
</head>
<body>
<div class="container">
  <h1>Dog Services Dashboard</h1>

  <div class="date-controls">
    <button id="prevDay" class="date-nav">&lt;</button>
    <button id="dateBtn" class="date-btn"></button>
    <button id="nextDay" class="date-nav">&gt;</button>
    <input type="date" id="dateInput" style="display:none; margin-left:10px;" />
    <button id="ratesBtn">Rates</button>
  </div>

  <div id="serviceDropdowns"></div>

  <table id="paymentTable">
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Total</th>
        <th>PABLO</th>
        <th>LILI</th>
        <th>JUGNIA</th>
        <th>LEO</th>
        <th>INDIA</th>
        <th>CHUFI</th>
        <th>CUSCO</th>
        <th>KIMCHI</th>
        <th>NINA</th>
        <th>CARMELA</th>
        <th>LUPE</th>
        <th>CUATRI</th>
        <th>TB</th>
        <th>NEO</th>
        <th>BRISO</th>
        <th>ZOZI</th>
        <th>R&H</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<!-- Rates Modal -->
<div id="ratesModal">
  <div id="ratesModalContent">
    <h2>Set Dog Rates (€)</h2>
    <div id="ratesInputs"></div>
    <button id="saveRates">Save</button>
    <button id="closeRates">Close</button>
  </div>
</div>

<script>
const dogNames = ["PABLO","LILI","JUGNIA","LEO","INDIA","KIMCHI","NINA","CARMELA","CUATRI","TB","NEO","BRISO","ZOZI","R&H"];
const extraDogs = ["CHUFI","LUPE","CUSCO"];
const allDogs = dogNames.concat(extraDogs);
let rows = [];
let selections = {};

let rates = {};
allDogs.forEach(d => rates[d]={daycare:10, weekend:12, overnight:20, walk:5});

let currentDate = new Date();
const dateBtn=document.getElementById('dateBtn');
const dateInput=document.getElementById('dateInput');
const serviceDropdowns=document.getElementById('serviceDropdowns');
const tbody=document.getElementById('tableBody');

function formatDate(d){ const dd=String(d.getDate()).padStart(2,'0'); const mm=String(d.getMonth()+1).padStart(2,'0'); const yyyy=d.getFullYear(); return `${dd}/${mm}/${yyyy}`; }
function updateDateBtn(){ dateBtn.textContent=formatDate(currentDate); }

function createServiceDropdowns(){
  ['Daycare','Walk','Overnight'].forEach(service=>{
    const div=document.createElement('div'); div.classList.add('dropdown');
    const label=document.createElement('div'); label.classList.add('service-label'); label.textContent=service; div.appendChild(label);
    const btn=document.createElement('button'); btn.textContent=`Select ${service}`; div.appendChild(btn);
    const content=document.createElement('div'); content.classList.add('dropdown-content');
    allDogs.forEach(dog=>{
      const dogBtn=document.createElement('button'); dogBtn.textContent=dog;
      dogBtn.addEventListener('click',()=>{ toggleDog(dog,service,dogBtn); });
      content.appendChild(dogBtn);
    });
    div.appendChild(content); serviceDropdowns.appendChild(div);
  });
}

function toggleDog(dog,service,btn){
  const dateStr=formatDate(currentDate);
  if(!selections[dateStr]) selections[dateStr]={};
  const key=`${dog}_${service}`;
  const selected=!selections[dateStr][key];
  selections[dateStr][key]=selected;
  btn.classList.toggle('active',selected);
  updateDogPayment(dog,service,selected);
}

function findRowByDate(dateStr){ return rows.find(r=>r.Fecha===dateStr); }

function updateDogPayment(dogName,service,add){
  const dateStr=formatDate(currentDate);
  let row=findRowByDate(dateStr);
  if(!row){ row={Fecha:dateStr,Total:0}; allDogs.forEach(d=>row[d]=0); rows.push(row); }
  let rate = rates[dogName][service.toLowerCase()];
  if(service==='Daycare' && (currentDate.getDay()===0 || currentDate.getDay()===6)) rate=rates[dogName].weekend;
  if(add){ row[dogName]+=rate; row.Total+=rate; } else { row.Total-=Math.min(rate,row[dogName]); row[dogName]=Math.max(0,row[dogName]-rate); }
  row.Total=Math.max(0,row.Total);
  buildTable();
}

function buildTable(){
  tbody.innerHTML='';
  rows.sort((a,b)=>new Date(a.Fecha.split('/').reverse().join('-'))-new Date(b.Fecha.split('/').reverse().join('-')));
  rows.forEach(r=>{
    const tr=document.createElement('tr');
    const parts=r.Fecha.split('/'); const rowDate=new Date(parts[2],parts[1]-1,parts[0]);
    if(rowDate.getDay()===0 || rowDate.getDay()===6) tr.classList.add('weekend');
    const tdFecha=document.createElement('td'); tdFecha.textContent=r.Fecha; tr.appendChild(tdFecha);
    const tdTotal=document.createElement('td'); tdTotal.textContent=r.Total+' €'; tdTotal.classList.add('currency'); tr.appendChild(tdTotal);
    allDogs.forEach(d=>{ const td=document.createElement('td'); td.textContent=r[d]||''; td.classList.add('currency'); tr.appendChild(td); });
    tbody.appendChild(tr);
  });
}

// Date input toggle
dateBtn.addEventListener('click',()=>{ dateInput.valueAsDate=currentDate; dateInput.style.display='inline-block'; });
dateInput.addEventListener('change',(e)=>{ currentDate=new Date(e.target.value); updateDateBtn(); restoreSelections(); dateInput.style.display='none'; buildTable(); });
document.getElementById('prevDay').addEventListener('click',()=>{ currentDate.setDate(currentDate.getDate()-1); updateDateBtn(); restoreSelections(); buildTable(); });
document.getElementById('nextDay').addEventListener('click',()=>{ currentDate.setDate(currentDate.getDate()+1); updateDateBtn(); restoreSelections(); buildTable(); });

// Restore button highlights per date
function restoreSelections() {
  const dateStr=formatDate(currentDate);
  document.querySelectorAll('.dropdown-content button').forEach(btn=>{
    const dog=btn.textContent;
    const service=btn.closest('.dropdown').querySelector('.service-label').textContent;
    const key=`${dog}_${service}`;
    btn.classList.toggle('active',selections[dateStr] && selections[dateStr][key]);
  });
}

// Rates modal
const ratesModal=document.getElementById('ratesModal');
const ratesInputsDiv=document.getElementById('ratesInputs');
function populateRatesModal(){
  ratesInputsDiv.innerHTML='';
  allDogs.forEach(d=>{
    const div=document.createElement('div');
    div.innerHTML=`${d}: Daycare <input type='number' id='daycare_${d}' value='${rates[d].daycare}'> Weekend <input type='number' id='weekend_${d}' value='${rates[d].weekend}'> Overnight <input type='number' id='overnight_${d}' value='${rates[d].overnight}'> Walk <input type='number' id='walk_${d}' value='${rates[d].walk}'>`;
    ratesInputsDiv.appendChild(div);
  });
}
document.getElementById('ratesBtn').addEventListener('click',()=>{ populateRatesModal(); ratesModal.style.display='flex'; });
document.getElementById('closeRates').addEventListener('click',()=>{ ratesModal.style.display='none'; });
document.getElementById('saveRates').addEventListener('click',()=>{
  allDogs.forEach(d=>{
    rates[d].daycare=parseFloat(document.getElementById('daycare_'+d).value)||0;
    rates[d].weekend=parseFloat(document.getElementById('weekend_'+d).value)||0;
    rates[d].overnight=parseFloat(document.getElementById('overnight_'+d).value)||0;
    rates[d].walk=parseFloat(document.getElementById('walk_'+d).value)||0;
  });
  ratesModal.style.display='none';
});

createServiceDropdowns();
updateDateBtn();
buildTable();
</script>
</body>
</html>
