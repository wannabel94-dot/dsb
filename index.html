<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Servicios</title>
<meta name="theme-color" content="#c1802a" />
<link rel="icon" href="icons/dog-192.png" sizes="192x192" type="image/png" />
<style>
/* ===== GLOBAL ===== */
* { box-sizing:border-box;margin:0;padding:0; }
body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto; background:#c6d197; min-height:100vh; padding:10px; }
.container{max-width:800px;margin:0 auto;padding:20px;}
h1{text-align:center;margin-bottom:20px;color:#373e2e;}
button{cursor:pointer;}

/* ===== DATE CONTROLS ===== */
.date-controls{display:flex;justify-content:center;align-items:center;gap:18px;margin-bottom:25px;}
.date-btn,.date-nav{
    padding:18px 28px;font-size:22px;font-weight:700;border:none;border-radius:14px;
    cursor:pointer;background:#303021;color:#c6d197;box-shadow:0 4px 10px rgba(0,0,0,0.2);transition:0.2s ease;
}
.date-btn:hover,.date-nav:hover{transform:scale(1.05);box-shadow:0 6px 14px rgba(0,0,0,0.3);}

/* ===== SUMMARY ===== */
.summary{background:#d4cba8;padding:20px;border-radius:16px;margin-top:20px;}
#summaryContent{line-height:1.6;}

/* ===== MODALS ===== */
/* BACKDROP */
.modal {
    display:none;
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.55);
    justify-content:flex-end; /* SLIDE UP FROM BOTTOM */
    padding:0;
    z-index:2000; /* ABOVE FOOTER */
}

/* SLIDE-UP PANEL */
.modal-content {
    background:white;
    width:100%;
    max-height:90vh;   /* ALMOST FULL SCREEN */
    border-radius:22px 22px 0 0;
    padding:25px;
    overflow-y:auto;   /* SCROLL FIX */
    box-shadow:0 -4px 20px rgba(0,0,0,0.25);
    animation:slideUp 0.3s ease-out;
}
.modal-buttons {
    bottom:0;
    background:white;
    padding:15px 0;
    display:flex;
    justify-content:flex-end;
    gap:10px;
}

/* Animation */
@keyframes slideUp {
    from { transform:translateY(100%); }
    to { transform:translateY(0); }
}


select,input[type="time"],input[type="number"],input[type="text"]{
    width:100%;padding:12px 14px;margin-top:8px;border-radius:10px;border:2px solid #8a8252;
    background:#fcf9f1;font-size:16px;color:#303021;
}

/* Buttons in modals */
.modal-buttons{display:flex;justify-content:flex-end;gap:12px;margin-top:18px;}
.modal-buttons button{padding:10px 18px;border:none;border-radius:10px;font-size:15px;font-weight:600;cursor:pointer;
    background:#a53200;color:#f9e9ca;transition:0.2s;}
.modal-buttons button:hover{transform:scale(1.04);background:#8a2b00;}

/* Service selection buttons */
.service-btn{padding:10px 14px;margin:6px;border:none;border-radius:12px;background:#a53200;color:#f9e9ca;font-weight:600;font-size:16px;cursor:pointer; transition:0.2s;}
.service-btn:hover{background:#8a2b00;transform:scale(1.05);}

/* ===== FOOTER ===== */
.footer-nav{position:fixed;bottom:0;left:0;right:0;height:60px;background:#303021;display:flex;justify-content:space-between;align-items:center;padding:0 25px; z-index:1500;}
.left-group,.right-group{display:flex;justify-content:space-between;width:120px;gap:0;}
.footer-nav .switch-btn{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;padding:6px 0;width:50px;background:transparent;border:none;cursor:pointer;border-radius:12px;}
.footer-nav .switch-btn img{width:22px;height:22px;opacity:0.9;filter:invert(1);}
.footer-nav .switch-btn span{color:#fff;font-weight:600;font-size:12px;}
.footer-nav .switch-btn.active span{color:#8d4585;font-weight:700;}

/* ===== FLOATING CENTER BUTTON ===== */
.floating-center-btn{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);
width:60px;height:60px;border-radius:50%;background:#a53200;border:none;
display:flex;justify-content:center;align-items:center;font-size:36px;font-weight:700;color:#c6d197;cursor:pointer;z-index:130;}

/* ===== TARIFS TABLE ===== */
#tarifsSheet table{width:100%;border-collapse:collapse;margin-top:10px;}
#tarifsSheet th,#tarifsSheet td{border:1px solid #8a8252;padding:8px;text-align:center;font-size:16px;}
#tarifsSheet th{background:#303021;color:#c6d197;font-weight:700;}
</style>
</head>
<body>

<div class="container">
<h1>Buen día!</h1>
<div class="date-controls">
  <button id="prevDay" class="date-nav">&lt;</button>
  <button id="dateBtn" class="date-btn"></button>
  <button id="nextDay" class="date-nav">&gt;</button>
</div>
<div class="summary">
  <h3>Agenda:</h3>
  <div id="summaryContent">No hay servicios seleccionados.</div>
</div>
</div>

<!-- SERVICE MODAL -->
<div id="serviceModal" class="modal">
  <div class="modal-content" id="modalContent">
    <h2>Seleccionar Perro</h2>
    <select id="dogSelect"></select>
    <div id="serviceButtonsContainer"></div>
    <div class="modal-buttons">
      <button id="closeModalBtn">Cancelar</button>
    </div>
  </div>
</div>

<!-- TIME MODAL -->
<div id="timeModal" class="modal">
  <div class="modal-content">
    <h2>Horario</h2>
    <label>Inicio:</label>
    <input id="startTimeInput" type="time" />
    <label>Fin:</label>
    <input id="endTimeInput" type="time" />
    <div class="modal-buttons">
      <button id="saveTimeBtn">Guardar</button>
      <button id="closeTimeModal">Cancelar</button>
    </div>
  </div>
</div>

<!-- TARIFS MODAL -->
<div id="tarifsSheet" class="modal">
  <div class="modal-content">
    <h2>Tarifas por Perro (€)</h2>
    <table id="tarifsTable">
      <thead>
        <tr><th>Perro</th><th>Día</th><th>Noche</th><th>Paseo</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="modal-buttons">
      <button id="addDogTarifBtn">Añadir Perro</button>
      <button id="saveTarifsBtn">Guardar</button>
      <button id="closeTarifsBtn">Cancelar</button>
    </div>
  </div>
</div>

<!-- FOOTER -->
<footer class="footer-nav">
  <div class="left-group">
    <button class="switch-btn tarifs" id="tarifsBtn"><img src="icons/tarifs.svg"><span>Tarifas</span></button>
    <button class="switch-btn accounts" id="accountsBtn"><img src="icons/accounts.svg"><span>Cuentas</span></button>
  </div>
  <div class="right-group">
    <button class="switch-btn profile" id="profileBtn"><img src="icons/vet.svg"><span>Perfiles</span></button>
    <button class="switch-btn blank" id="calendarBtn"><img src="icons/agenda.svg"><span>Agenda</span></button>
  </div>
</footer>

<button class="floating-center-btn" id="centralBtn">+</button>

<script>
const defaultDogs = ["PABLO","LILI","JUGNIA","LEO","INDIA","KIMCHI","NINA","CARMELA","CUATRI","TB","NEO","BRISO","ZOZI","R&H"];
let allDogs = JSON.parse(localStorage.getItem('allDogs')) || defaultDogs;
let selections = JSON.parse(localStorage.getItem('selections')) || {};
let tarifs = JSON.parse(localStorage.getItem('tarifs')) || {};
let currentDate = new Date();
const formatDate = d=>`${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${d.getFullYear()}`;

function updateDate(){ document.getElementById('dateBtn').textContent = formatDate(currentDate); }
updateDate();

document.getElementById('prevDay').onclick = ()=>{currentDate.setDate(currentDate.getDate()-1); updateDate(); updateSummary();}
document.getElementById('nextDay').onclick = ()=>{currentDate.setDate(currentDate.getDate()+1); updateDate(); updateSummary();}
document.getElementById('dateBtn').onclick = ()=>{
  const input=document.createElement('input'); input.type='date'; input.style.display='none'; document.body.appendChild(input);
  input.valueAsDate=currentDate; input.click();
  input.onchange=()=>{currentDate=new Date(input.value); updateDate(); updateSummary(); input.remove();}
}

// SERVICE MODAL
const serviceModal = document.getElementById('serviceModal');
const dogSelect = document.getElementById('dogSelect');
const serviceButtonsContainer = document.getElementById('serviceButtonsContainer');
let tempSelection={dog:null,services:[],start:'',end:''};

document.getElementById('centralBtn').onclick=()=>{
  dogSelect.innerHTML=''; allDogs.forEach(d=>{const opt=document.createElement('option'); opt.value=d; opt.textContent=d; dogSelect.appendChild(opt);});
  document.querySelector('#modalContent h2').textContent='Seleccionar Perro';
  serviceButtonsContainer.innerHTML='';
  serviceModal.style.display='flex';
};

document.getElementById('dogSelect').onchange=()=>{ renderServiceButtons(); }
function renderServiceButtons(){
  serviceButtonsContainer.innerHTML='';
  ['Daycare','Overnight','Walk'].forEach(s=>{
    const btn=document.createElement('button'); btn.className='service-btn'; btn.textContent=s;
    btn.onclick=()=>{
      tempSelection.dog=dogSelect.value;
      tempSelection.services=[s];
      serviceModal.style.display='none';
      document.getElementById('startTimeInput').value='';
      document.getElementById('endTimeInput').value='';
      document.getElementById('timeModal').style.display='flex';
    }
    serviceButtonsContainer.appendChild(btn);
  });
}

document.getElementById('closeModalBtn').onclick=()=>{serviceModal.style.display='none';}

// TIME MODAL
document.getElementById('saveTimeBtn').onclick=()=>{
  tempSelection.start=document.getElementById('startTimeInput').value;
  tempSelection.end=document.getElementById('endTimeInput').value;
  const dateKey=formatDate(currentDate);
  if(!selections[dateKey]) selections[dateKey]={};
  tempSelection.services.forEach(s=>{
    selections[dateKey][`${tempSelection.dog}_${s}`]={selected:true,start:tempSelection.start,end:tempSelection.end};
  });
  localStorage.setItem('selections',JSON.stringify(selections));
  document.getElementById('timeModal').style.display='none';
  updateSummary();
}
document.getElementById('closeTimeModal').onclick=()=>{document.getElementById('timeModal').style.display='none';}

// UPDATE SUMMARY
function updateSummary(){
  const dateKey=formatDate(currentDate);
  const div=document.getElementById('summaryContent');
  if(!selections[dateKey]){div.textContent='No hay servicios seleccionados.'; return;}
  let html=''; const groups={};
  Object.entries(selections[dateKey]).forEach(([key,val])=>{
    if(!val.selected) return;
    const [dog,service]=key.split('_'); if(!groups[dog]) groups[dog]=[];
    groups[dog].push(`${service}: ${val.start} → ${val.end}`);
  });
  for(let dog in groups){ html+=`<strong>${dog}</strong><br>`; groups[dog].forEach(s=>{html+=`• ${s}<br>`}); html+='<br>'; }
  div.innerHTML=html||'No hay servicios seleccionados.';
}
updateSummary();

// TARIFS MODAL
const tarifsSheet=document.getElementById('tarifsSheet');
const tarifsTableBody=document.querySelector('#tarifsTable tbody');
function loadTarifs(){
  tarifsTableBody.innerHTML=''; allDogs.forEach(d=>{
    if(!tarifs[d]) tarifs[d]={day:10,night:10,walk:10};
    const row=document.createElement('tr');
    row.innerHTML=`<td>${d}</td>
      <td><input type="number" min="0" value="${tarifs[d].day}"></td>
      <td><input type="number" min="0" value="${tarifs[d].night}"></td>
      <td><input type="number" min="0" value="${tarifs[d].walk}"></td>`;
    tarifsTableBody.appendChild(row);
  });
}
loadTarifs();

document.getElementById('tarifsBtn').onclick=()=>{tarifsSheet.style.display='flex';}
document.getElementById('closeTarifsBtn').onclick=()=>{tarifsSheet.style.display='none';}
document.getElementById('saveTarifsBtn').onclick=()=>{
  [...tarifsTableBody.querySelectorAll('tr')].forEach(tr=>{
    const dog=tr.children[0].textContent;
    tarifs[dog]={day:Number(tr.children[1].querySelector('input').value),night:Number(tr.children[2].querySelector('input').value),walk:Number(tr.children[3].querySelector('input').value)};
  });
  localStorage.setItem('tarifs',JSON.stringify(tarifs));
  tarifsSheet.style.display='none';
}

// ADD DOG POPUP
document.getElementById('addDogTarifBtn').onclick=()=>{
  const name=prompt("Introduce el nombre del perro:");
  if(!name) return; if(allDogs.includes(name)){alert("Perro ya existe."); return;}
  allDogs.push(name); localStorage.setItem('allDogs',JSON.stringify(allDogs));
  tarifs[name]={day:10,night:10,walk:10}; loadTarifs();
}
</script>
</body>
</html>
